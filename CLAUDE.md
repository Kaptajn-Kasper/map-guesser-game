# Map Guesser Game

Angular-based map guessing game. Deployed via the infrastructure repo's `deploy-apps` system.

## Repository structure

- `src/` — Angular application source
- `src/environments/` — Environment config files (gitignored, injected at deploy time)
- `docker-compose.prod.yml` — Production compose file (Caddy network, `Dockerfile.prod`)
- `docker-compose.dev.yml` — Local development compose file (port-mapped, live-reload)
- `Dockerfile.prod` — Multi-stage build: Node build + nginx serve
- `Caddyfile.snippet` — Prod Caddy routing (`map-guesser.kaptajnkasper.net`)
- `Caddyfile.snippet.dev` — Dev Caddy routing (`dev.map-guesser.kaptajnkasper.net`)
- `nginx/` — Nginx config files for both dev and prod

## Deployment

This app is deployed by the `deploy-apps` script from the [infrastructure](https://github.com/Kaptajn-Kasper/infrastructure) repo. Do not deploy manually.

### Deploy prod

```bash
deploy-apps --app map-guesser-game
```

### Deploy a feature branch to dev

```bash
# First run seeds configs — copy from prod, then re-run:
deploy-apps --app map-guesser-game --env dev --branch feature/my-feature
cp /opt/apps/configs/map-guesser-game/src/environments/environment.prod.ts \
   /opt/apps/configs/map-guesser-game-dev/src/environments/environment.prod.ts
cp /opt/apps/configs/map-guesser-game/src/environments/environment.ts \
   /opt/apps/configs/map-guesser-game-dev/src/environments/environment.ts
deploy-apps --app map-guesser-game --env dev --branch feature/my-feature
```

### Update dev with new commits

```bash
deploy-apps --app map-guesser-game --env dev --branch feature/my-feature
```

### Tear down dev

```bash
deploy-apps --app map-guesser-game --env dev --teardown
```

## URLs

| Environment | URL |
|-------------|-----|
| Prod | `https://map-guesser.kaptajnkasper.net` |
| Dev | `https://dev.map-guesser.kaptajnkasper.net` |

## Config files

Managed via `/opt/apps/configs/map-guesser-game/` (or `-dev/` for dev env). These are injected into the app directory at deploy time:

- `src/environments/environment.ts` — Dev environment config
- `src/environments/environment.prod.ts` — Prod environment config (contains MapTiler API key)

## Docker

- Prod container: `map-guesser-game-app-prod` on `caddy-network`
- Dev container: `map-guesser-game-app-dev` on `caddy-network` (auto-generated override)
- `.compose.env-override.yml` is auto-generated by `deploy-apps --env` and gitignored

## Adding a new environment

1. Create `Caddyfile.snippet.<env>` with the subdomain routing to `map-guesser-game-app-<env>:80`
2. Add a DNS A record for the subdomain
3. Deploy: `deploy-apps --app map-guesser-game --env <name> --branch <branch>`
